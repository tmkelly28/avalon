<section id="room">
	<!-- Players -->
	<div class="col-md-12" id="players">
		<!-- Player -->
		<div class="player-box" 
			href="#"
			ng-repeat="player in game.players">

			<h5>{{ player.displayName }}</h5>
			<img ng-src="{{ player.picture }}"
				 ng-class="{activeShadow: (game.currentPlayerTurn._id === player._id)}" 
				 id="playerPicture"/>

			<img class="character" 
				 ng-src="{{ player.imageUrl }}"
				 ng-if="me(player) || (game.currentGamePhase.slice(0, 3) === 'end') || (game.currentGamePhase === 'guess merlin' && player.loyalty === 'evil' && player.character !== 'Oberon')"/>

			<img ng-src="/icons/approve.png"
				 ng-if="player.approvedQuest && (game.currentGamePhase === 'quest voting' || game.currentGamePhase === 'team building')"
				 ng-hide="(game.currentQuestIdx === 0 && game.currentVoteTrack === 0 && game.currentGamePhase === 'team building')"
				 class="voteToken"/>
			<img ng-src="/icons/reject.png"
				 ng-if="!player.approvedQuest && (game.currentGamePhase === 'quest voting' || game.currentGamePhase === 'team building')"
				 ng-hide="(game.currentQuestIdx === 0 && game.currentVoteTrack === 0) && game.currentGamePhase === 'team building'"
				 class="voteToken"/>
			<img ng-src="/icons/lady_of_the_lake.png"
				 ng-if="game.currentLadyOfTheLake._id === player._id"
				 class="voteToken"/>	 
			<img ng-src="/icons/sigil.png"
				 ng-if="player.onQuest"
				 class="sigil"/>

			<div id="playerSelection">
				<a name="addToTeam"
					ng-if="myTurn && game.roomLeftOnTeam && (game.currentGamePhase === 'team building') && !player.onQuest"
					href="#"
					class="selectPlayer"
					ng-click="addToTeam(player)">
					<span class="glyphicon glyphicon-plus"></span>
					Add to team</a>
				<a name="guessMerlin"
					ng-if="user.character === 'Assassin' && (game.currentGamePhase === 'guess merlin') && (player.loyalty === 'good' || player.character === 'Oberon')"
					href="#"
					class="selectPlayer"
					ng-click="guessMerlin(player)">
					Guess Merlin</a>
				<a name="useLady"
					ng-if="(user._id === game.currentLadyOfTheLake._id) && (game.currentGamePhase === 'using lady') && (!player.hasBeenLadyOfTheLake) && (player._id !== user._id)"
					href="#"
					class="selectPlayer"
					ng-click="useLady(player)">
					<span class="glyphicon glyphicon-eye-open"></span>
					Use Lady of the Lake</a>	
			</div>
		</div>

	</div>

	<!-- Quest Log -->
	<div id="questLog">
		<div ng-repeat="quest in game.quests">
			<span class="quest" ng-class="{ activeShadow: ((game.currentQuestIdx + 1) === quest.questNumber), questFail: quest.status === 'fail', questPass: quest.status === 'success'}">
				<p ng-class="{opaque: quest.status}">{{ quest.playersNeeded }}</p>
			</span>
			<span class="questInfo"> Quest # {{ quest.questNumber }}
				<span ng-if="quest.toFail > 1">(2 fails)</span>
			</span>
		</div>
		<div id="voteTrack">
			<img ng-src="" />
			Vote Track:
		{{ game.currentVoteTrack }}
		</div>
	</div>

	<!-- Grails -->
	<div id="questResult" ng-hide="game.currentGamePhase === 'team voting' || game.currentGamePhase === 'quest voting'">
		<span ng-repeat="n in range(0, game.previousQuestSuccess)">
			<img class="grail" 
			    ng-src="/icons/success.png" />
		</span>
		<span ng-repeat="n in range(0, game.previousQuestFail)">
			<img class="grail" 
				ng-src="/icons/fail.png" />
		</span>
	</div>

 	<!-- Game Log -->
 	<div class="well" id="gamelog">
 		<p ng-repeat="player in game.players">
 			<span ng-if="(user.character==='Percival') && (player.character==='Morgana')">
 				<span class="glyphicon glyphicon-eye-open"></span>
 				{{ player.displayName }} is a wizard
 			</span>
 			<span ng-if="(user.character==='Percival') && (player.character==='Merlin')">
 				<span class="glyphicon glyphicon-eye-open"></span>
 				{{ player.displayName }} is a wizard
 			</span>
 			<span ng-if="(user.loyalty==='evil') && (player.loyalty==='evil') && (player.character !=='Oberon')">
 				<span class="glyphicon glyphicon-eye-open"></span>
 				{{ player.displayName }} is a fellow agent of evil
 			</span>
 			<span ng-if="(user.character==='Merlin') && (player.loyalty==='evil') && (player.character !=='Mordred')">
 				<span class="glyphicon glyphicon-eye-open"></span>
 				{{ player.displayName }} is an agent of evil
 			</span>
 		</p>
 		<p ng-if="investigatedPlayer">
			<span class="glyphicon glyphicon-eye-open"></span>
			{{ investigatedPlayer.displayName }} is {{ investigatedPlayer.loyalty }}
		<p>
 	</div>

 	<!-- Chat History -->
	<div class="well" id="chat">
		<p ng-repeat="chat in chats | orderBy:'-'">{{ chat.text }}</p>
	</div>

	<!-- Button Bar -->
	<div id="buttonBar">
		<form>
			<button 
				class="btn btn-success" 
			    ng-disabled="!ableToBegin()"
			    ng-if="isHost()"
			    ng-hide="!game.waitingToPlay"
			    ng-click="startGame()">
			    Begin Game
			</button>
			<a 
				class="btn btn-default"  
			    ng-click="voteApprove()"
			    ng-if="(game.currentGamePhase === 'team voting') && needToVoteForTeam">
			    Approve
			</a>
			<a 
				class="btn btn-default"  
			    ng-click="voteReject()"
			    ng-if="(game.currentGamePhase === 'team voting') && needToVoteForTeam">
			    Reject
			</a>
			<a 
				class="btn btn-default"  
			    ng-click="successQuest()"
			    ng-if="(game.currentGamePhase === 'quest voting') && user.onQuest && needToVoteOnQuest">
			    Success
			</a>
			<a 
				class="btn btn-default"  
			    ng-click="failQuest()"
			    ng-if="(game.currentGamePhase === 'quest voting') && user.onQuest && needToVoteOnQuest">
			    Fail
			</a>
			<button 
				class="btn btn-default"  
			    ng-click="proposeTeam()"
			    ng-disabled="disablePropose(game)"
			    ng-if="myTurn && (game.currentGamePhase === 'team building')">
			    Propose Team
			</button>
			<a 
				class="btn btn-default"
				ng-if="myTurn && (game.currentGamePhase === 'team building')"
			    ng-click="resetTeam()">
			    Reset Team
			</a>
		</form>
	</div>

	<div id="gameResult">
		<alert ng-if="game.currentGamePhase==='guess merlin'">Good has prevailed, but now evil may guess Merlin</alert>
		<alert ng-if="game.currentGamePhase==='end evil wins'">Evil wins!</alert>
		<alert ng-if="game.currentGamePhase==='end good wins'">Good wins!</alert>
		<alert ng-if="game.currentGamePhase==='end evil guessed merlin'">Evil Guessed Merlin! Evil Wins</alert>
	</div>

	<!-- Chat Entry -->
	<div id="chatEntry">
		<form name="chat">
			<div class="form-group">
				<input 
					name="chatInput" 
				    type="text"
					ng-model="newMessage.text"
					placeholder="Enter your message"
					class="form-control" />
			</div>
			<input 
				type="submit" 
				class="btn btn-default" 
				ng-click="addMessage()">
			</input>
		</form>
	</div>
</section>